<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>すばらしきSteamゲームの本棚</title>
<meta name="description" content="おすすめSteamゲームのセール情報と紹介記事。価格推移をチェックしてお得にゲームを手に入れよう。">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
<link rel="stylesheet" href="style.css">
<!-- Google AdSense（承認後にdata-ad-clientを設定） -->
<!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script> -->
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js"></script>
</head>
<body>

<div class="container" x-data="dashboard()" x-init="init()" x-cloak>

  <!-- ヘッダー -->
  <header class="site-header">
    <div class="header-card">
      <h1 class="site-title">すばらしきSteamゲームの本棚</h1>
      <p class="site-description">おすすめSteamゲームのセール・価格情報をお届け。気になるゲームをウィッシュリストに入れる前にチェック！</p>
      <div class="header-meta">
        <span class="header-date" x-text="lastUpdate ? `最終更新: ${lastUpdate}` : '読み込み中...'"></span>
        <span class="header-divider"></span>
        <span class="header-count" x-text="`${games.length}タイトル`"></span>
      </div>
    </div>
  </header>

  <!-- セール中バナー -->
  <template x-if="onSaleGames.length > 0">
    <section class="sale-banner">
      <h2>セール中！</h2>
      <div class="sale-cards">
        <template x-for="g in onSaleGames" :key="g.appid">
          <a :href="`https://store.steampowered.com/app/${g.appid}/`" target="_blank" class="sale-card">
            <img :src="g.header_image" :alt="g.name" loading="lazy">
            <div class="sale-info">
              <span class="sale-badge" x-text="`-${g.discount_percent}%`"></span>
              <span class="sale-name" x-text="g.name"></span>
              <span class="sale-price" x-text="g.price_formatted"></span>
            </div>
          </a>
        </template>
      </div>
    </section>
  </template>

  <!-- 2カラムレイアウト: サイドバー + メイン -->
  <div class="layout">

    <!-- サイドバー -->
    <aside class="sidebar">
      <!-- テキスト検索 -->
      <div class="sidebar-section">
        <h3>検索</h3>
        <input type="search" x-model="searchQuery" placeholder="ゲーム名で検索..." class="search-input">
      </div>

      <!-- ジャンルフィルター -->
      <div class="sidebar-section">
        <h3>ジャンル</h3>
        <div class="genre-list">
          <button class="genre-chip" :class="selectedGenres.length === 0 ? 'genre-active' : ''" @click="selectedGenres = []">
            すべて
            <span class="genre-count" x-text="games.length"></span>
          </button>
          <template x-for="g in allGenres" :key="g.name">
            <button class="genre-chip" :class="selectedGenres.includes(g.name) ? 'genre-active' : ''" @click="toggleGenre(g.name)">
              <span x-text="g.name"></span>
              <span class="genre-count" x-text="g.count"></span>
            </button>
          </template>
        </div>
      </div>

      <!-- 表示フィルター -->
      <div class="sidebar-section">
        <h3>表示</h3>
        <label class="filter-check">
          <input type="checkbox" x-model="showOnlySale">
          セール中のみ
        </label>
        <label class="filter-check">
          <input type="checkbox" x-model="showOnlyWithArticle">
          記事ありのみ
        </label>
      </div>

      <!-- ソート -->
      <div class="sidebar-section">
        <h3>並び替え</h3>
        <select x-model="sortKey" class="sort-select">
          <option value="name">タイトル順</option>
          <option value="price_asc">価格が安い順</option>
          <option value="price_desc">価格が高い順</option>
          <option value="review">レビュー順</option>
          <option value="discount">割引率順</option>
        </select>
      </div>

      <!-- AdSense サイドバー広告 -->
      <!-- <ins class="adsbygoogle" style="display:block" data-ad-format="auto" data-full-width-responsive="true"></ins> -->
    </aside>

    <!-- メインコンテンツ -->
    <main class="main-content">

      <!-- フィルター結果 -->
      <div class="filter-status" x-show="searchQuery || selectedGenres.length > 0 || showOnlySale || showOnlyWithArticle">
        <span x-text="`${filteredGames.length}件表示`"></span>
        <button class="clear-filter" @click="clearFilters()">フィルター解除</button>
      </div>

      <!-- ゲーム一覧 -->
      <section class="game-list">
        <h2>ゲーム一覧</h2>
        <div class="game-grid">
          <template x-for="g in filteredGames" :key="g.appid">
            <article class="game-card">
              <a :href="`https://store.steampowered.com/app/${g.appid}/`" target="_blank">
                <img :src="g.header_image" :alt="g.name" class="game-header-img" loading="lazy">
              </a>
              <div class="game-body">
                <h3 class="game-name" x-text="g.name"></h3>
                <p class="game-desc" x-text="g.short_description"></p>
                <div class="game-meta">
                  <span class="game-genres" x-text="g.genres ? g.genres.slice(0, 3).join(' / ') : ''"></span>
                  <span class="game-release" x-text="g.release_date || ''"></span>
                </div>
                <div class="game-price-row">
                  <template x-if="g.discount_percent > 0">
                    <span class="discount-badge" x-text="`-${g.discount_percent}%`"></span>
                  </template>
                  <template x-if="g.discount_percent > 0">
                    <span class="price-original" x-text="formatYen(g.price_initial)"></span>
                  </template>
                  <span class="price-final" :class="g.discount_percent > 0 ? 'price-sale' : ''" x-text="g.is_free ? '無料' : formatYen(g.price_final)"></span>
                </div>
                <div class="game-review" x-show="g.total_reviews > 0">
                  <div class="review-bar">
                    <div class="review-positive" :style="`width: ${g.total_reviews ? (g.total_positive / g.total_reviews * 100) : 0}%`"></div>
                  </div>
                  <span class="review-text" x-text="`${g.review_score_desc} (${g.total_positive.toLocaleString()}/${g.total_reviews.toLocaleString()})`"></span>
                </div>
                <div class="game-links">
                  <a :href="`https://store.steampowered.com/app/${g.appid}/`" target="_blank" class="btn-steam">Steamで見る</a>
                  <template x-if="g.has_article">
                    <a :href="`articles/${g.slug}.html`" class="btn-article">記事を読む</a>
                  </template>
                </div>
              </div>
            </article>
          </template>
        </div>
        <p class="no-results" x-show="filteredGames.length === 0">条件に一致するゲームがありません。</p>
      </section>

      <!-- 記事一覧 -->
      <section class="articles-section">
        <h2>記事</h2>
        <template x-if="articles.length === 0">
          <p class="no-articles">記事は準備中です。</p>
        </template>
        <div class="article-grid">
          <template x-for="a in articles" :key="a.slug">
            <a :href="`articles/${a.slug}.html`" class="article-card">
              <h3 x-text="a.title"></h3>
              <div class="article-tags">
                <template x-for="tag in (a.tags || [])" :key="tag">
                  <span class="tag" x-text="tag"></span>
                </template>
              </div>
            </a>
          </template>
        </div>
      </section>

    </main>
  </div>
</div>

<footer class="container">
  <p>すばらしきSteamゲームの本棚 | Steam のデータは <a href="https://store.steampowered.com/" target="_blank">Valve Corporation</a> に帰属します</p>
</footer>

<script src="app.js"></script>
</body>
</html>
