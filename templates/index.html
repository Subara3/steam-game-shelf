<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>すばらしきSteamゲームの本棚</title>
<meta name="description" content="おすすめSteamゲームのセール情報と紹介記事。価格推移をチェックしてお得にゲームを手に入れよう。">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
<link rel="stylesheet" href="style.css">
<!-- Google AdSense: ca-pub-ID を設定して有効化 -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js"></script>
</head>
<body>

<div class="container" x-data="dashboard()" x-init="init()" x-cloak>

  <!-- ヘッダー -->
  <header class="site-header">
    <div class="header-card">
      <div class="header-top-row">
        <h1 class="site-title" x-text="t('siteTitle')"></h1>
        <div class="lang-switch">
          <button :class="lang === 'ja' ? 'lang-active' : ''" @click="switchLang('ja')">JP</button>
          <button :class="lang === 'en' ? 'lang-active' : ''" @click="switchLang('en')">EN</button>
        </div>
      </div>
      <p class="site-description" x-text="t('siteDesc')"></p>
      <div class="header-meta">
        <span class="header-date" x-text="lastUpdate ? `${t('lastUpdate')}: ${lastUpdate}` : t('loading')"></span>
        <span class="header-divider"></span>
        <span class="header-count" x-text="`${games.length} ${t('titles')}`"></span>
      </div>
    </div>
  </header>

  <!-- セール中バナー -->
  <template x-if="onSaleGames.length > 0">
    <section class="sale-banner">
      <h2 x-text="t('onSale')"></h2>
      <div class="sale-cards">
        <template x-for="g in onSaleGames" :key="g.appid">
          <a :href="`https://store.steampowered.com/app/${g.appid}/`" target="_blank" class="sale-card">
            <img :src="g.header_image" :alt="g.name" loading="lazy">
            <div class="sale-info">
              <span class="sale-badge" x-text="`-${g.discount_percent}%`"></span>
              <span class="sale-name" x-text="g.name"></span>
              <span class="sale-price" x-text="g.price_formatted"></span>
            </div>
          </a>
        </template>
      </div>
    </section>
  </template>

  <!-- 2カラムレイアウト -->
  <div class="layout">

    <!-- サイドバー -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <h3 x-text="t('search')"></h3>
        <input type="search" x-model="searchQuery" :placeholder="t('searchPlaceholder')" class="search-input">
      </div>

      <div class="sidebar-section">
        <h3 x-text="t('genre')"></h3>
        <div class="genre-list">
          <button class="genre-chip" :class="selectedGenres.length === 0 ? 'genre-active' : ''" @click="selectedGenres = []">
            <span x-text="t('genreAll')"></span>
            <span class="genre-count" x-text="games.length"></span>
          </button>
          <template x-for="g in allGenres" :key="g.name">
            <button class="genre-chip" :class="selectedGenres.includes(g.name) ? 'genre-active' : ''" @click="toggleGenre(g.name)">
              <span x-text="g.name"></span>
              <span class="genre-count" x-text="g.count"></span>
            </button>
          </template>
        </div>
      </div>

      <div class="sidebar-section">
        <h3 x-text="t('sale')"></h3>
        <div class="sale-filter-list">
          <label class="filter-radio">
            <input type="radio" value="off" x-model="saleFilter">
            <span x-text="t('genreAll')"></span>
          </label>
          <label class="filter-radio">
            <input type="radio" value="all" x-model="saleFilter">
            <span x-text="t('saleAll')"></span>
          </label>
          <label class="filter-radio">
            <input type="radio" value="sale50" x-model="saleFilter">
            <span x-text="t('sale50')"></span>
          </label>
          <label class="filter-radio">
            <input type="radio" value="sale30" x-model="saleFilter">
            <span x-text="t('sale30')"></span>
          </label>
          <label class="filter-radio">
            <input type="radio" value="sale10" x-model="saleFilter">
            <span x-text="t('sale10')"></span>
          </label>
        </div>
      </div>

      <div class="sidebar-section">
        <h3 x-text="t('display')"></h3>
        <label class="filter-check">
          <input type="checkbox" x-model="showOnlyWithArticle">
          <span x-text="t('onlyArticle')"></span>
        </label>
        <label class="filter-check">
          <input type="checkbox" x-model="hideR18">
          <span x-text="t('hideR18')"></span>
        </label>
      </div>

      <div class="sidebar-section">
        <h3 x-text="t('sort')"></h3>
        <select x-model="sortKey" class="sort-select">
          <option value="name" x-text="t('sortName')"></option>
          <option value="price_asc" x-text="t('sortPriceAsc')"></option>
          <option value="price_desc" x-text="t('sortPriceDesc')"></option>
          <option value="review" x-text="t('sortReview')"></option>
          <option value="discount" x-text="t('sortDiscount')"></option>
        </select>
      </div>
    </aside>

    <!-- メインコンテンツ -->
    <main class="main-content">

      <div class="filter-status" x-show="isFiltering">
        <span x-text="`${filteredGames.length}${t('showing')}`"></span>
        <button class="clear-filter" @click="clearFilters()" x-text="t('clearFilter')"></button>
      </div>

      <section class="game-list">
        <h2 x-text="t('gameList')"></h2>
        <div class="game-grid-wrap">
          <template x-for="(g, idx) in filteredGames" :key="g.appid">
            <div>
              <!-- 6件ごとに広告を挿入 -->
              <template x-if="idx > 0 && idx % 6 === 0">
                <div class="ad-slot ad-slot-inline">
                  <ins class="adsbygoogle"
                    style="display:block"
                    data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                    data-ad-slot="XXXXXXXXXX"
                    data-ad-format="auto"
                    data-full-width-responsive="true"></ins>
                </div>
              </template>
              <article class="game-card" :class="isR18(g) ? 'game-card-r18' : ''">
                <!-- R18 年齢ゲート -->
                <template x-if="isR18(g) && !isAgeConfirmed(g)">
                  <div class="age-gate">
                    <div class="age-gate-inner">
                      <span class="age-gate-badge" x-text="t('ageBadge')"></span>
                      <h3 class="game-name" x-text="gameName(g)"></h3>
                      <p class="age-gate-msg" x-text="t('ageConfirm')"></p>
                      <div class="age-gate-buttons">
                        <button class="btn-age-yes" @click="confirmAge(g.appid)" x-text="t('ageYes')"></button>
                        <a :href="`https://store.steampowered.com/app/${g.appid}/`" target="_blank" class="btn-age-no" x-text="t('viewOnSteam')"></a>
                      </div>
                    </div>
                  </div>
                </template>
                <!-- 通常表示 -->
                <template x-if="!isR18(g) || isAgeConfirmed(g)">
                  <div>
                    <div class="game-img-wrap">
                      <a :href="`https://store.steampowered.com/app/${g.appid}/`" target="_blank">
                        <img :src="g.header_image" :alt="gameName(g)" class="game-header-img" loading="lazy">
                      </a>
                      <span class="r18-badge" x-show="isR18(g)" x-text="t('ageBadge')"></span>
                    </div>
                    <div class="game-body">
                      <h3 class="game-name" x-text="gameName(g)"></h3>
                      <p class="game-desc" x-text="gameDesc(g)"></p>
                      <div class="game-meta">
                        <span class="game-genres" x-text="gameGenres(g).slice(0, 3).join(' / ')"></span>
                        <span class="game-release" x-text="gameRelease(g)"></span>
                      </div>
                      <div class="game-price-row">
                        <template x-if="g.discount_percent > 0">
                          <span class="discount-badge" x-text="`-${g.discount_percent}%`"></span>
                        </template>
                        <template x-if="g.discount_percent > 0">
                          <span class="price-original" x-text="formatYen(g.price_initial)"></span>
                        </template>
                        <span class="price-final" :class="g.discount_percent > 0 ? 'price-sale' : ''" x-text="g.is_free ? t('free') : formatYen(g.price_final)"></span>
                      </div>
                      <div class="game-review-text" x-show="g.review_score_desc">
                        <span class="review-label" x-text="reviewText(g)"></span>
                      </div>
                      <div class="game-links">
                        <a :href="`https://store.steampowered.com/app/${g.appid}/`" target="_blank" class="btn-steam" x-text="t('viewOnSteam')"></a>
                        <template x-if="g.has_article">
                          <a :href="`articles/${g.slug}.html`" class="btn-article" x-text="t('readArticle')"></a>
                        </template>
                      </div>
                    </div>
                  </div>
                </template>
              </article>
            </div>
          </template>
        </div>
        <p class="no-results" x-show="filteredGames.length === 0" x-text="t('noResults')"></p>
      </section>

      <!-- セクション間広告 -->
      <div class="ad-slot ad-slot-between">
        <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
          data-ad-slot="XXXXXXXXXX"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      </div>

      <section class="articles-section">
        <h2 x-text="t('articles')"></h2>
        <template x-if="articles.length === 0">
          <p class="no-articles" x-text="t('articlesWip')"></p>
        </template>
        <div class="article-grid">
          <template x-for="a in articles" :key="a.slug">
            <a :href="`articles/${a.slug}.html`" class="article-card">
              <h3 x-text="a.title"></h3>
              <div class="article-tags">
                <template x-for="tag in (a.tags || [])" :key="tag">
                  <span class="tag" x-text="tag"></span>
                </template>
              </div>
            </a>
          </template>
        </div>
      </section>

    </main>
  </div>
</div>

<footer class="container">
  <p><span x-data="{ t: (localStorage.getItem('lang') || 'ja') === 'en' ? 'The Wonderful Steam Game Shelf' : 'すばらしきSteamゲームの本棚' }" x-text="t"></span> | Steam data &copy; <a href="https://store.steampowered.com/" target="_blank">Valve Corporation</a></p>
</footer>

<script src="app.js"></script>
</body>
</html>
